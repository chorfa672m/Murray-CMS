var connect = require('connect'),
    app = require('express').createServer(),
    express = require('express'),
    db = require('mongous').Mongous,
    problog = require('./problog.js');
// var db = new Db('local', new Server('localhost', {}));

var blogPrototype = {
  init: function(blogModel){
    this.blog = blogModel;
  },
  getBlog: function(){
    console.log('this is the post:' + this.blog);
  }
};
function blog(model){
  function B(){};
  B.prototype = blogPrototype;
  var b = new B;
  b.init(model);
  return b;
};

app.get('/', function(req, res){
  db('local.local').find(5, function(reply){
    res.render('index.jade', {posts: reply.documents});
    console.log(reply.documents)
  });

/*  db.open(function(err,db){
            db.collection('local', function(err, collection) {
            for(var i = 1; i < 1000; i++) {
              collection.insert({c:1}, function(err, docs) {});
            }
    db.collection('local', function(err, collection){
      collection.find(function(err,cursor){
        sys.puts("Printing docs from Cursor Each")
            cursor.each(function(err, doc) {
              if(doc != null) sys.puts("Doc from Each " + sys.inspect(doc));
            db.close();
            }) 
      })
    })
  })
  }) */
});
app.get('/new', function(req,res){
  res.render('newpost.jade');  
});
app.post('/brandnew', function(req, res){
  var newblog = blog('new blog post');
  newblog.getBlog();
  res.send('check out the console');
});

app.listen(3000);
console.log('running at localhost:3000');